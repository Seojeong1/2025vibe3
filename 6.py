import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# -------------------
# 1. ë°ì´í„° ì •ì˜
# -------------------
df = pd.DataFrame({
    "êµ­ê°€": ["South Korea", "USA", "Germany", "India", "Nigeria", "Japan", "Brazil", "China"],
    "FTO_ë¹ˆë„": [0.12, 0.45, 0.42, 0.31, 0.05, 0.11, 0.32, 0.13],
    "TCF7L2_ë¹ˆë„": [0.28, 0.38, 0.35, 0.39, 0.41, 0.30, 0.34, 0.29],
    "ê¸°ë³¸_ë¹„ë§Œë¥ ": [5.3, 36.2, 22.3, 4.0, 8.9, 4.3, 22.1, 6.2],
    "ê¸°ë³¸_ë‹¹ë‡¨ë³‘ë¥ ": [8.2, 10.5, 9.5, 8.9, 4.5, 7.4, 10.1, 9.1]
})

# -------------------
# 2. Streamlit UI
# -------------------
st.set_page_config(page_title="ìœ ì „í˜• ê¸°ë°˜ ì§ˆë³‘ ë¦¬ìŠ¤í¬ ë§µ", layout="wide")
st.title("ğŸ§¬ ìœ ì „í˜• ê¸°ë°˜ êµ­ê°€ë³„ ì§ˆë³‘ ìœ„í—˜ ì‹œë®¬ë ˆì´ì…˜")

st.markdown("ë‹¹ì‹ ì´ ë³´ìœ í•œ ìœ ì „ìë¥¼ ì„ íƒí•˜ë©´, êµ­ê°€ë³„ ë¹„ë§Œë¥ ê³¼ ë‹¹ë‡¨ë³‘ë¥ ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

col1, col2 = st.columns(2)
with col1:
    user_fto = st.selectbox("FTO ìœ ì „ì ë³´ìœ  ì—¬ë¶€ (ë¹„ë§Œ ê´€ë ¨)", ["ë¹„ë³´ìœ ", "ë³´ìœ "])
with col2:
    user_tcf = st.selectbox("TCF7L2 ìœ ì „ì ë³´ìœ  ì—¬ë¶€ (ë‹¹ë‡¨ ê´€ë ¨)", ["ë¹„ë³´ìœ ", "ë³´ìœ "])

# -------------------
# 3. ìœ ì „ì ìœ„í—˜ ê°€ì¤‘ì¹˜ ì„¤ì •
# -------------------
risk_factor_fto = 1.67 if user_fto == "ë³´ìœ " else 1.0
risk_factor_tcf = 1.45 if user_tcf == "ë³´ìœ " else 1.0

# -------------------
# 4. ê³„ì‚°: ìœ„í—˜ ì ìˆ˜ & ì˜ˆì¸¡
# -------------------
df["FTO_ìœ„í—˜ì ìˆ˜"] = (df["FTO_ë¹ˆë„"] * risk_factor_fto).round(2)
df["TCF7L2_ìœ„í—˜ì ìˆ˜"] = (df["TCF7L2_ë¹ˆë„"] * risk_factor_tcf).round(2)

df["ì˜ˆìƒ_ë¹„ë§Œë¥ (%)"] = (df["ê¸°ë³¸_ë¹„ë§Œë¥ "] * df["FTO_ìœ„í—˜ì ìˆ˜"]).round(2)
df["ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)"] = (df["ê¸°ë³¸_ë‹¹ë‡¨ë³‘ë¥ "] * df["TCF7L2_ìœ„í—˜ì ìˆ˜"]).round(2)

# -------------------
# 5. ìœ„í—˜ ë“±ê¸‰ ë° í‰ê·  ë¹„êµ
# -------------------
mean_obesity = df["ì˜ˆìƒ_ë¹„ë§Œë¥ (%)"].mean()
mean_diabetes = df["ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)"].mean()

df["ë¹„ë§Œ_í‰ê· ì´ˆê³¼ì—¬ë¶€"] = df["ì˜ˆìƒ_ë¹„ë§Œë¥ (%)"].apply(lambda x: "â¬† ì´ˆê³¼" if x > mean_obesity else "â¬‡ ì´í•˜")
df["ë‹¹ë‡¨_í‰ê· ì´ˆê³¼ì—¬ë¶€"] = df["ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)"].apply(lambda x: "â¬† ì´ˆê³¼" if x > mean_diabetes else "â¬‡ ì´í•˜")

def ìœ„í—˜ë“±ê¸‰(score):
    if score > 35: return "ğŸ”´ High"
    elif score > 20: return "ğŸŸ  Medium"
    else: return "ğŸŸ¢ Low"

df["ë¹„ë§Œ_ë“±ê¸‰"] = df["ì˜ˆìƒ_ë¹„ë§Œë¥ (%)"].apply(ìœ„í—˜ë“±ê¸‰)
df["ë‹¹ë‡¨_ë“±ê¸‰"] = df["ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)"].apply(ìœ„í—˜ë“±ê¸‰)

# -------------------
# 6. ê²°ê³¼ í‘œ ì¶œë ¥
# -------------------
st.subheader("ğŸ“‹ êµ­ê°€ë³„ ì§ˆë³‘ ìœ„í—˜ ì˜ˆì¸¡ ê²°ê³¼")

st.dataframe(df[[
    "êµ­ê°€", "FTO_ìœ„í—˜ì ìˆ˜", "TCF7L2_ìœ„í—˜ì ìˆ˜",
    "ì˜ˆìƒ_ë¹„ë§Œë¥ (%)", "ë¹„ë§Œ_ë“±ê¸‰", "ë¹„ë§Œ_í‰ê· ì´ˆê³¼ì—¬ë¶€",
    "ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)", "ë‹¹ë‡¨_ë“±ê¸‰", "ë‹¹ë‡¨_í‰ê· ì´ˆê³¼ì—¬ë¶€"
]])

# -------------------
# 7. ì‹œê°í™”
# -------------------
st.subheader("ğŸ“Š êµ­ê°€ë³„ ì§ˆë³‘ ìœ„í—˜ ì‹œê°í™”")

tab1, tab2 = st.tabs(["ë¹„ë§Œë¥  ì˜ˆì¸¡", "ë‹¹ë‡¨ë³‘ë¥  ì˜ˆì¸¡"])

with tab1:
    fig1 = px.bar(df.sort_values("ì˜ˆìƒ_ë¹„ë§Œë¥ (%)", ascending=False),
                  x="êµ­ê°€", y="ì˜ˆìƒ_ë¹„ë§Œë¥ (%)", color="ë¹„ë§Œ_ë“±ê¸‰",
                  title="êµ­ê°€ë³„ ì˜ˆìƒ ë¹„ë§Œë¥ ", labels={"ì˜ˆìƒ_ë¹„ë§Œë¥ (%)": "ì˜ˆìƒ ë¹„ë§Œë¥  (%)"})
    st.plotly_chart(fig1, use_container_width=True)

with tab2:
    fig2 = px.bar(df.sort_values("ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)", ascending=False),
                  x="êµ­ê°€", y="ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)", color="ë‹¹ë‡¨_ë“±ê¸‰",
                  title="êµ­ê°€ë³„ ì˜ˆìƒ ë‹¹ë‡¨ë³‘ë¥ ", labels={"ì˜ˆìƒ_ë‹¹ë‡¨ë³‘ë¥ (%)": "ì˜ˆìƒ ë‹¹ë‡¨ë³‘ë¥  (%)"})
    st.plotly_chart(fig2, use_container_width=True)
